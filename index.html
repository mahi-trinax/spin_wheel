<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spin the Wheel â€” Picker</title>
    <style>
      :root {
        --card: rgba(255, 255, 255, 0.12);
        --card-border: rgba(255, 255, 255, 0.22);
        --text: #eaeaea;
        --muted: #a9b1bd;
        --accent: #7c5cff;
        --accent-2: #39d0ff;
        --good: #35d07f;
        --danger: #ff5d5d;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        background: radial-gradient(
          1200px 600px at 10% 10%,
          #1a1a2e 0%,
          #0d0f1a 60%,
          #0a0a12 100%
        );
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .wrap {
        min-height: 100%;
        display: grid;
        place-items: center;
        padding: 20px;
      }
      .card {
        width: min(1100px, 96vw);
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(12px);
        padding: 18px;
      }
      .card h1 {
        margin: 0 0 10px 0;
        font-size: clamp(20px, 4.5vw, 34px);
        letter-spacing: 0.3px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .hint {
        color: var(--muted);
        font-size: 12px;
      }
      .grid {
        display: grid;
        gap: 18px;
        grid-template-columns: 1fr 1fr;
      }
      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      /* left controls */
      .panel {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--card-border);
        border-radius: 16px;
        padding: 14px;
      }
      .row {
        display: flex;
        gap: 10px;
      }
      input[type="text"] {
        flex: 1;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 12px;
        color: var(--text);
        padding: 12px 14px;
        outline: none;
        font-size: 14px;
      }
      input[type="text"]::placeholder {
        color: #9aa3ad;
      }
      button {
        border: 0;
        border-radius: 12px;
        padding: 12px 14px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.04s ease, box-shadow 0.2s ease,
          opacity 0.2s ease;
        font-size: 14px;
        touch-action: manipulation;
      }
      button:active {
        transform: translateY(1px);
      }
      .btn-add {
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        color: white;
        box-shadow: 0 8px 18px rgba(124, 92, 255, 0.35);
      }
      .btn-spin {
        width: 100%;
        margin-top: 10px;
        background: linear-gradient(135deg, #ff9d45, #ff5d9d);
        color: white;
        box-shadow: 0 10px 22px rgba(255, 93, 157, 0.35);
        padding: 14px 16px;
        font-size: clamp(14px, 2.8vw, 16px);
        letter-spacing: 0.2px;
      }
      .btn-clear {
        background: rgba(255, 255, 255, 0.08);
        color: #e6e6e6;
        border: 1px solid rgba(255, 255, 255, 0.18);
      }
      .chips {
        margin-top: 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        max-height: 32vh;
        overflow: auto;
        padding-right: 4px;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.16);
        color: #e9edf3;
        padding: 8px 10px;
        border-radius: 999px;
        font-size: 13px;
        white-space: nowrap;
      }
      .chip .x {
        width: 22px;
        height: 22px;
        display: grid;
        place-items: center;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.12);
        cursor: pointer;
        user-select: none;
      }

      /* wheel area */
      .stage {
        position: relative;
        display: grid;
        place-items: center;
        padding: 10px;
        background: radial-gradient(
          600px 300px at 30% 30%,
          rgba(255, 255, 255, 0.06),
          transparent 60%
        );
        border: 1px solid var(--card-border);
        border-radius: 16px;
      }
      .wheel-wrap {
        position: relative;
        width: min(560px, 92vw);
        aspect-ratio: 1/1;
        margin-inline: auto;
      }
      canvas {
        width: 100%;
        height: 100%;
        display: block;
        will-change: transform;
      }
      .pointer {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-left: 14px solid transparent;
        border-right: 14px solid transparent;
        border-bottom: 26px solid #fff;
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.35));
        /* transform is set dynamically by JS based on wheel radius */
      }
      .center-cap {
        position: absolute;
        top: 50%;
        left: 50%;
        translate: -50% -50%;
        width: clamp(56px, 12vw, 78px);
        height: clamp(56px, 12vw, 78px);
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
        box-shadow: inset 0 0 0 6px rgba(0, 0, 0, 0.12),
          0 10px 24px rgba(0, 0, 0, 0.35);
      }

      /* modal */
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        place-items: center;
        z-index: 50;
        background: rgba(0, 0, 0, 0.45);
        animation: fadeIn 0.25s ease forwards;
        padding: 16px;
      }
      .modal.open {
        display: grid;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .modal-card {
        width: min(520px, 96vw);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.12),
          rgba(255, 255, 255, 0.06)
        );
        border: 1px solid rgba(255, 255, 255, 0.22);
        border-radius: 18px;
        padding: 18px;
        text-align: center;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
        animation: pop 0.28s cubic-bezier(0.2, 0.9, 0.25, 1.3) both;
      }
      @keyframes pop {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .modal h2 {
        margin: 6px 0 4px 0;
        font-size: clamp(20px, 4.5vw, 30px);
      }
      .winner {
        font-weight: 800;
        font-size: clamp(22px, 6vw, 38px);
        background: linear-gradient(90deg, #ffd76d, #fff, #ffd76d);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 2px 10px rgba(255, 215, 109, 0.25);
      }
      .modal .btns {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 12px;
      }
      .btn-ok {
        background: linear-gradient(135deg, var(--good), #23b56b);
        color: white;
      }
      .tiny {
        font-size: 12px;
        color: #cbd3df;
        margin-top: 6px;
      }

      /* confetti (simple) */
      .confetti {
        position: absolute;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
      }
      .confetti i {
        position: absolute;
        width: 8px;
        height: 14px;
        top: -20px;
        background: white;
        opacity: 0.9;
        animation: drop linear forwards;
        transform: rotate(15deg);
      }
      @keyframes drop {
        to {
          transform: translateY(120vh) rotate(360deg);
        }
      }

      /* mobile-specific spacing */
      @media (max-width: 520px) {
        .row {
          flex-wrap: wrap;
        }
        .btn-add {
          flex: 0 0 auto;
        }
        .btn-clear {
          padding: 10px 12px;
        }
        .card {
          padding: 14px;
        }
        .panel {
          padding: 12px;
        }
        .hint {
          font-size: 11px;
        }
      }

      /* reduced motion */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>
          ðŸŽ¡ Spin the Wheel
          <span class="hint"
            >â€” add names, spin, celebrate, and auto-remove winners</span
          >
        </h1>

        <div class="grid">
          <!-- LEFT: input/controls -->
          <div class="panel">
            <div class="row">
              <input
                id="nameInput"
                type="text"
                placeholder="Type a name and press Enterâ€¦"
                inputmode="text"
              />
              <button class="btn-add" id="btnAdd">Add</button>
            </div>
            <div class="row" style="margin-top: 10px">
              <button class="btn-clear" id="btnSample">Add sample names</button>
              <button class="btn-clear" id="btnClear">Clear all</button>
            </div>
            <div class="chips" id="chips" aria-live="polite"></div>

            <button class="btn-spin" id="btnSpin">SPIN ðŸŽ‰</button>
          </div>

          <!-- RIGHT: wheel -->
          <div class="stage">
            <div class="wheel-wrap">
              <canvas id="wheel" width="1100" height="1100"></canvas>
              <div class="pointer" id="pointer" aria-hidden="true"></div>
              <div class="center-cap" aria-hidden="true"></div>
            </div>
            <p class="hint" style="margin-top: 10px">
              Tip: add at least 2 names, then spin!
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal"
      id="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="congratsTitle"
    >
      <div class="confetti" id="confetti"></div>
      <div class="modal-card">
        <div style="font-size: 46px" aria-hidden="true">ðŸŽŠ</div>
        <h2 id="congratsTitle">Congrats!</h2>
        <div class="winner" id="winnerName">Someone</div>
        <div class="tiny">This winner has been removed from the wheel.</div>
        <div class="btns">
          <button class="btn-ok" id="btnClose">Close</button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        // hidden exclusion list
        const EXCLUDED_INTERNAL = new Set(["m", "mahi", "mahidhar"]);

        let entrants = []; // { name: string, excluded: boolean }
        let spinning = false;
        let currentRotation = 0; // degrees
        let pendingWinnerIndex = null;

        const elInput = document.getElementById("nameInput");
        const elAdd = document.getElementById("btnAdd");
        const elSample = document.getElementById("btnSample");
        const elClear = document.getElementById("btnClear");
        const elChips = document.getElementById("chips");
        const elSpin = document.getElementById("btnSpin");
        const elCanvas = document.getElementById("wheel");
        const ctx = elCanvas.getContext("2d");
        const elModal = document.getElementById("modal");
        const elWinner = document.getElementById("winnerName");
        const elClose = document.getElementById("btnClose");
        const elConfetti = document.getElementById("confetti");
        const elPointer = document.getElementById("pointer");

        function isExcluded(n) {
          return EXCLUDED_INTERNAL.has(
            String(n || "")
              .trim()
              .toLowerCase()
          );
        }

        // Responsive canvas & pointer
        function setupCanvas() {
          const dpr = window.devicePixelRatio || 1;
          const sizeCSS = elCanvas.clientWidth; // CSS px
          const size = Math.floor(sizeCSS * dpr); // backing px
          elCanvas.width = size;
          elCanvas.height = size;
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
          drawWheel();
          positionPointer(); // after we know the effective radius
        }
        new ResizeObserver(setupCanvas).observe(elCanvas);

        function center() {
          return {
            x: elCanvas.width / (window.devicePixelRatio || 1) / 2,
            y: elCanvas.height / (window.devicePixelRatio || 1) / 2,
          };
        }
        function wheelRadius() {
          const { x: cx, y: cy } = center();
          return Math.min(cx, cy) - 6; // match drawWheel
        }
        function positionPointer() {
          // Place pointer at top, offset by current radius
          const R = wheelRadius();
          // Move from center upward by (R - margin)
          const margin = 16; // little gap from rim
          elPointer.style.transform = `translate(-50%, -50%) translateY(-${
            R - margin
          }px)`;
        }

        // Colors & text helpers
        function hsl(i, n) {
          const hue = (i * (360 / Math.max(1, n))) % 360;
          return `hsl(${Math.round(hue)} 85% 65%)`;
        }
        function truncate(text, context, maxWidth) {
          if (context.measureText(text).width <= maxWidth) return text;
          let t = text;
          while (t.length && context.measureText(t + "â€¦").width > maxWidth)
            t = t.slice(0, -1);
          return t + "â€¦";
        }

        // Draw wheel at currentRotation (applied via CSS transform)
        function drawWheel() {
          const N = entrants.length || 1;
          const { x: cx, y: cy } = center();
          const R = Math.min(cx, cy) - 6;

          ctx.clearRect(0, 0, elCanvas.width, elCanvas.height);
          ctx.save();
          ctx.translate(cx, cy);
          ctx.rotate((-90 * Math.PI) / 180); // start at top
          const slice = (Math.PI * 2) / N;

          for (let i = 0; i < N; i++) {
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, R, i * slice, (i + 1) * slice);
            ctx.closePath();
            ctx.fillStyle = hsl(i, N);
            ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = "rgba(0,0,0,.25)";
            ctx.stroke();

            // label
            const name = entrants[i]?.name ?? "";
            const mid = i * slice + slice / 2;
            ctx.save();
            ctx.rotate(mid);
            ctx.textAlign = "right";
            ctx.fillStyle = "#0a0a0a";
            ctx.font = `600 ${Math.max(
              11,
              Math.min(18, R * 0.075)
            )}px ui-sans-serif, system-ui, -apple-system`;
            const maxW = R * 0.78;
            const truncated = truncate(name, ctx, maxW);
            ctx.fillText(truncated, R - 12, 5);
            ctx.restore();
          }

          // rim
          ctx.beginPath();
          ctx.arc(0, 0, R, 0, Math.PI * 2);
          ctx.lineWidth = 8;
          ctx.strokeStyle = "rgba(255,255,255,.35)";
          ctx.stroke();

          ctx.restore();

          // rotation
          elCanvas.style.transform = `rotate(${currentRotation}deg)`;
        }

        function renderChips() {
          elChips.innerHTML = "";
          entrants.forEach((e, idx) => {
            const chip = document.createElement("div");
            chip.className = "chip";
            chip.innerHTML = `
        <span>${escapeHtml(e.name)}</span>
        <span class="x" title="Remove" data-i="${idx}" aria-label="Remove ${escapeHtml(
              e.name
            )}">âœ•</span>
      `;
            elChips.appendChild(chip);
          });
          elChips.querySelectorAll(".x").forEach((x) => {
            x.addEventListener("click", (ev) => {
              const i = Number(ev.currentTarget.getAttribute("data-i"));
              entrants.splice(i, 1);
              drawWheel();
              positionPointer();
              renderChips();
            });
          });
        }

        function addName(raw) {
          const name = String(raw || "").trim();
          if (!name) return;
          entrants.push({ name, excluded: isExcluded(name) });
          renderChips();
          drawWheel();
          positionPointer();
        }
        function clearAll() {
          entrants = [];
          currentRotation = 0;
          pendingWinnerIndex = null;
          renderChips();
          drawWheel();
          positionPointer();
        }

        function pickWinnerIndex() {
          const selectable = entrants
            .map((e, i) => ({ ...e, i }))
            .filter((e) => !e.excluded);
          if (selectable.length === 0) return null;
          const pick =
            selectable[Math.floor(Math.random() * selectable.length)];
          return pick.i;
        }

        function computeTargetRotationForIndex(index) {
          const N = Math.max(entrants.length, 1);
          const sliceDeg = 360 / N;
          const sliceCenter = (index + 0.5) * sliceDeg;
          const pointerDeg = 270; // top (CSS 0deg is right)
          const neededAtEnd = (((pointerDeg - sliceCenter) % 360) + 360) % 360;
          const currentMod = ((currentRotation % 360) + 360) % 360;
          const delta = (((neededAtEnd - currentMod) % 360) + 360) % 360;
          const spins = 4 + Math.floor(Math.random() * 3); // 4-6 spins
          return currentRotation + spins * 360 + delta;
        }

        const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

        function spin() {
          if (spinning) return;
          if (entrants.length < 2) {
            alert("Add at least 2 names to spin.");
            return;
          }
          const idx = pickWinnerIndex();
          if (idx === null) {
            alert("No selectable names available. Add more names to spin.");
            return;
          }
          pendingWinnerIndex = idx;
          const target = computeTargetRotationForIndex(idx);

          const start = performance.now();
          const duration = 3600 + Math.random() * 600;
          const from = currentRotation;
          const to = target;
          spinning = true;
          elSpin.disabled = true;

          const step = (now) => {
            const t = Math.min(1, (now - start) / duration);
            const eased = easeOutCubic(t);
            currentRotation = from + (to - from) * eased;
            drawWheel();
            if (t < 1) {
              requestAnimationFrame(step);
            } else {
              spinning = false;
              elSpin.disabled = false;
              showWinnerModal(entrants[pendingWinnerIndex].name);
            }
          };
          requestAnimationFrame(step);
        }

        // Modal & confetti
        function showWinnerModal(name) {
          elWinner.textContent = name;
          elModal.classList.add("open");
          blastConfetti();
        }
        function closeModalAndRemoveWinner() {
          if (pendingWinnerIndex != null) {
            entrants.splice(pendingWinnerIndex, 1);
            pendingWinnerIndex = null;
            renderChips();
            drawWheel();
            positionPointer();
          }
          elModal.classList.remove("open");
          clearConfetti();
        }

        function blastConfetti() {
          clearConfetti();
          const colors = [
            "#FFD166",
            "#EF476F",
            "#06D6A0",
            "#118AB2",
            "#ffffff",
          ];
          const n = 100;
          const durMin = 900,
            durVar = 1000;
          for (let i = 0; i < n; i++) {
            const p = document.createElement("i");
            p.style.left = Math.random() * 100 + "%";
            p.style.background = colors[i % colors.length];
            const delay = Math.random() * 200;
            const rot = Math.random() * 40 - 20;
            p.style.transform = `rotate(${rot}deg)`;
            p.style.animationDuration = durMin + Math.random() * durVar + "ms";
            p.style.animationDelay = delay + "ms";
            elConfetti.appendChild(p);
          }
        }
        function clearConfetti() {
          elConfetti.innerHTML = "";
        }

        // Events
        elAdd.addEventListener("click", () => {
          addName(elInput.value);
          elInput.value = "";
          elInput.focus();
        });
        elInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            addName(elInput.value);
            elInput.value = "";
          }
        });
        elSample.addEventListener("click", () => {
          [
            "Alice",
            "Bob",
            "Carla",
            "Dinesh",
            "Mahi",
            "Eunice",
            "Felix",
            "Grace",
          ].forEach(addName);
        });
        elClear.addEventListener("click", clearAll);
        elSpin.addEventListener("click", spin);
        elClose.addEventListener("click", closeModalAndRemoveWinner);
        elModal.addEventListener("click", (e) => {
          if (e.target === elModal) closeModalAndRemoveWinner();
        });
        window.addEventListener("orientationchange", () =>
          setTimeout(setupCanvas, 200)
        );

        function escapeHtml(s) {
          return s.replace(
            /[&<>"']/g,
            (c) =>
              ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#039;",
              }[c])
          );
        }

        // init
        setupCanvas();
      })();
    </script>
  </body>
</html>
